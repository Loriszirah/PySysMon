<!DOCTYPE html>
<html lang="fr">
<% include header %>
  <body>
    <!-- ==================================            SCRIPTS           =============================== -->
    <script>
      $(document).on('keypress', '#search-bar', function(e){
        var socket = io();
        var socket = io.connect();
        if(e.keyCode == 13) {
          e.preventDefault();
          var data = document.getElementById("search-bar").value;
          socket.emit('searchincidents', { data : data });
          socket.on('searchResincidents', function(result){
            if(result.success == true){
              $.get( '/searchincidents',{incidents:result.incidents, nbincidents:result.nbincidents, success:result.success,}, function(data) {
                document.body.innerHTML = data;
              });
            }else if(result.success == false){
              $.get( '/searchincidents',{incidents:result.incidents, nbincidents:result.nbincidents, success:result.success,}, function(data) {
                document.body.innerHTML = data;
              });
            }
          });
        }
      });


    </script>

    <!-- ==================================            /           =============================== -->
    <% include navbar %>
    <div class="container-fluid">
      <div class="row">
        <% include sidebar %>

        <div  class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <h1 class="page-header">Incidents</h1>

          <div class="center row">
            <div class="col-md-12">

              <div class="text-center">
                <ul class="btn-group nav nav-pills nav-success" id="myTab">
                    <li class="label-danger active"><a data-toggle="tab" href="#menu1">En Cours</a></li>
                    <li class="label-success"><a data-toggle="tab" href="#menu2">Résolus</a></li>

                </ul>
                <div class="tab-content" id="myTabContent">
                  <div id="menu1" class="tab-pane fade-danger active in">
                    <p>
                      <% if(success == true){%>

                      <div class="row">

                        <% incidents.forEach(function(incident , index) { %>
                          <% if(incident.resolu == false || incident.resolu == 'false'){ %>

                            <% if(incident.typeincident == "Charge"){ %>
                              <div class="panel panel-danger">
                                <div class="panel-heading"><i><%= incident.datedebincident %></i> : Incident sur l'hôte <b><%= incident.hote %></b></h4></div>
                                <div class="panel-body">
                                La machine <%= incident.hote %> subi actuellement une charge de : <%= incident.infoincident %>
                                </div>
                              </div>
                            <% } else if(incident.typeincident == "RAM"){ %>
                              <div class="panel panel-warning">
                                <div class="panel-heading"><i><%= incident.datedebincident %></i> : Incident sur l'hôte <b><%= incident.hote %></b></h4></div>
                                <div class="panel-body">
                                La machine <%= incident.hote %> consomme actuellement : <%= incident.infoincident %> % de la mémoire RAM disponible
                                </div>
                              </div>
                            <% } %>
                          <% } %>
                        <% }); %>
                      </div>
                    </p>
                  </div>
                  <div id="menu2" class="tab-pane fade">
                    <p>
                      <div class="row">
                        <% incidents.forEach(function(incident , index) { %>
                          <% if(incident.resolu == true || incident.resolu == 'true'){ %>
                            <% if(incident.typeincident == "Charge"){ %>
                              <div class="panel panel-success">
                                <div class="panel-heading"><i>Date de début : <%= incident.datedebincident %></i> : Incident sur l'hôte <b><%= incident.hote %></b></h4></div>
                                <div class="panel-body">
                                La machine <%= incident.hote %> subissait une charge trop élevée
                                Cependant le probléme a été résolu le <%= incident.datefinincident %>.
                                </div>
                              </div>
                            <% } else if(incident.typeincident == "RAM"){ %>
                              <div class="panel panel-success">
                                <div class="panel-heading"><i>Date de début : <%= incident.datedebincident %></i> : Incident sur l'hôte <b><%= incident.hote %></b></h4></div>
                                <div class="panel-body">
                                La machine <%= incident.hote %> consommait une trop grande quantité de mémoire RAM disponible.
                                Cependant le probléme a été résolu le <%= incident.datefinincident %>.
                                </div>
                              </div>
                            <% } %>
                          <% } %>
                        <% }); %>
                      </div>
                    </p>
                  </div>
                  <%} else if(success == false){%>
                  <h3>Aucun résultat à votre recherche</h3>
                  <%}%>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
